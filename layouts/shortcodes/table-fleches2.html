{{ $resultFile := "./fleches/results.json" }}
{{ $trunc := 3 }}

{{ $colors   := slice "blanche" "noire" "bleu" "rouge" "jaune" "bronze" "argent" "or" }}
{{ $armePrefixes := slice "c" "po" "sv" "ch"}}
{{ $armes    := dict "c" "Classique" "po" "Poulie" "sv" "Sans viseur" "ch" "Chasse" }}

{{ with try (resources.Get $resultFile) }}
    {{ with .Err }}
        {{ warnf "%s" . }}
    {{ else with .Value }}
        {{ $data := . | transform.Unmarshal }}
        <!-- FULLNAME LIST -->
        {{ range $k, $archer := $data }}
            <div>
                <a href="#res-{{ $k }}">
                    {{ $archer.last_name | truncate $trunc | upper }}, {{ $archer.first_name }}
                </a>
            </div>
        {{ end }}
        <!-- ARCHER LOOP -->
        {{ range $k, $archer := $data }}
            <h3 id="res-{{ $k}}">{{ $archer.last_name | truncate $trunc | upper }}, {{ $archer.first_name }}</h3>
            <table>
            {{ range $kp, $prefix := $armePrefixes }}
            {{ $arme := index $armes $prefix }}
            <!-- {{ $arme }} / {{ $prefix }} -->
            {{ range $kc, $color := $colors }} <!-- LOOP ON COLOR -->
                {{ $resKey := add $prefix "_" $color }}
                {{ $resKeyDate := add $prefix "_" $color "_date" }}
                {{ if index $archer $resKey }}
                </tr>
                    <td>{{ $arme }} {{ $color }}</td>
                    <td>{{ index $archer $resKey }}</td>
                    <td>{{ index $archer $resKeyDate }}</td>
                </tr>
                {{ end }} <!-- END IF -->
            {{ end }}
            {{ end }}
            </table>
        {{ end }}
    {{ else }}
        {{ warnf "Unable to get remote resource %q" $resultFile}}
    {{ end }}
{{ end }}